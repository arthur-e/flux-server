The Carbon Data Explorer Web API Server ("flux-server")
=======================================================

API reference for The Carbon Data Explorer Web API Server ("flux-server").

Entry Points
------------------------------------------

    GET /flux/api/scenarios.json
    GET /flux/api/[scenario]/grid.json
    GET /flux/api/[scenario]/xy.json
    GET /flux/api/[scenario]/t.json

* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
    
Resources
------------------------------------------

### Metadata (scenarios.json)

    /flux/api/scenarios.json?scenario=<scenario>
    /flux/api/scenarios/<scenario>.json
    
Example output:

    {
    "_id": "casa_gfed_2004",
    "gridded": true,
    "dates": ["2003-12-22T03:00:00","2005-01-01T00:00:00"],
    "units": {
        "y": "degrees",
        "x": "degrees",
        "values": "&mu;mol/m&sup2;"
    },
    "grid": {
        "units":"degrees",
        "x":1,
        "y":1
    },
    "bbox": [-166.5,10.5,-50.5,69.5],
    "title": "Surface Carbon Flux",
    "bboxmd5": "6f3e33c145010bc74c5ccd3ba772f504",
    "steps": [10800],
    "stats": {
        "values": {
            "std": 1.420790533818395,
            "max": 11.88,
            "min": -58.22,
            "median": 0.37,
            "mean": -0.007137192660180173
        }
    }
    }
    

### Grid Geometry (grid.json)

    /flux/api/scenarios/<scenario>/grid.json
    
Example output, instance of a GeoJSON `MultiPoint`:

    {
    "type": "MultiPoint",
    "coordinates": [
        [-166.5, 65.5],
        ...
    ]


### Map Data (xy.json)

    /flux/api/scenarios/<scenario>/xy.json
    
Example output (raster case):

    {
    "timestamp": "2003-12-22T03:00:00.000Z",
    "features": [
        0.08,
        0.15,
        ...
    ]
    }

Example output (vector case):

    {
    "properties": {
        "start": "2009-06-16T00:00:00",
        "end": "2009-06-21T00:00:00"
    },
    "features": [{
        "timestamp": "2009-06-16T00:00:00",
        "coordinates": [-175.488, -50.41476]
        "properties": {
        "value": "376.74",
        "error": "0.3677"
        }
    }, {
        ...
    }]
    }

Example output, derivative of a GeoJSON `FeatureCollection`for the raster case, generated by passing the `verbose` flag:

    {
    "type": "FeatureCollection",
    "features": [{
        "type": "Point",
        "coordinates": [-166.5, 65.5],
        "properties": {
        "v": 0.08
        }
    }, {
        ...
    }]
    }

    
### Time Series Data (t.json)

    /flux/api/scenarios/<scenario>/t.json

Example output:

    {
    "properties": {
        "start": "2003-12-22T03:00:00",
        "end": "2005-01-01T00:00:00"
    },
    "series": [
        0.27,
        0.42
        ...
    ]
    }


* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 

Examples
------------------------------------------

### Getting Metadata ##########################################################

    GET scenarios.json

### Getting a Map (XY Data) ####################################################

#### Getting a Map at a Specified Time

    GET xy.json?time=2004-05-01T03:00:00

#### Aggregation in Time

The `aggregate` keyword is used to specify the kind of aggregate data desired. Here is an example of aggregation in time; aggregating total positive flux over a specified period. The aggregation is performed "element-wise" stacking maps (as arrays) together so as to produce a value for each grid cell.

    GET xy.json?start=2004-05-01T03:00:00&end=2004-06-01T03:00:00&aggregate=positive

And here is a map of net flux over a month for each grid cell:

    GET xy.json?start=2004-05-01T03:00:00&end=2004-05-02T03:00:00&aggregate=net

### Getting a Time Series ######################################################

As with the XY endpoint, the `aggregate` keyword is used to specify the kind of aggregate data desired. The `start` and `end` keywords are required in aggregation, but should not be used with the `coords` parameter.

#### Filtering in Space

The `t.json` endpoint requires that a single value be generated for each time step. With spatiotemporal data, this means that either spatial filtering or spatial aggregation is required. **Spatial filtering produces one value for each time step according to the selected spatial filter**. The `coords` parameter selects the single value occuring at the coordinate location.  Here's an example of how to obtain a Time Series at a specified point in a spatiotemporal collection of rasters:

    GET t.json?coords=POINT(-50.5+69.5)&start=2004-05-01T03:00:00&end=2004-05-02T03:00:00

Alternatively, the `geom` parameter can be used to select a single for each time step representing the *mean* value of all data points occurring within the provided WKT `POLYGON()`. When using the `geom` parameter, the server will return not only the `mean` value but also data arrays representing `min`, `max`, `standard deviation`, and `n` for the points within the geometry.

    GET t.json?start=2004-05-01T03:00:00&end=2004-05-02T03:00:00&interval=weekly&geom=POLYGON((-97%2B46%2C-101%2B37%2C-93%2B35%2C-89%2B42%2C-97%2B46))

    
#### Aggregation in Space

**Spatial aggregation produces one value for each time step by aggregating values at different points in space, but at the same time, into one value for that time.** The `aggregate` parameter is used to specify the method by which the spatial dimension is aggregated into a single value for each time step. The available aggregates are:

| Keyword    | Description
| ---------- | --------------------------------------------
| `mean`     | Returns the arithmetic mean of the values
| `min`      | Returns the minimum value
| `max`      | Returns the maximum value
| `net`      | Returns the sum of the values
| `positive` | Returns the sum of only the positive values
| `negative` | Returns the sum of only the negative values


Here is an example of the mean value displayed for every time frame in the original dataset; it is presented at the same resolution as the non-aggregated data:

    GET t.json?start=2003-12-22T03:00:00&end=2005-01-01T00:00:00&aggregate=mean

Spatial filtering using the `coords` or `geom` parameter with the `aggregate` parameter is not yet supported.
    
#### Aggregation in Both Space and Time

The `interval` parameter can be used to further aggregate in time. If spatial filtering is also requested (with the `geom` parameter), then the specified aggregate is also applied over the spatial subset before being applied to each time step (e.g. the mean daily value of the means). Here is a time series of net daily flux across the entire dataset (in this case, net daily flux of North America) for each day of the month. 

    GET t.json?start=2003-12-22T03:00:00&end=2005-01-01T00:00:00&aggregate=mean&interval=daily

